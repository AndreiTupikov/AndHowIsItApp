@using Microsoft.AspNet.Identity
@model AndHowIsItApp.Models.ReviewShowViewModel

@{
    ViewBag.Title = "Review Page";
}

<div name="picture" id="picture-@Model.Id" data-filepath="@Model.PictureLink" data-postfix=""></div>

@if (User.IsInRole("admin") || User.Identity.GetUserId() == Model.AuthorId)
{
    <div>@Html.ActionLink(AndHowIsItApp.Resources.Language.EditReview, "EditReview", new { userId = Model.AuthorId, reviewId = Model.Id }, new { @class = "btn btn-outline-dark" })</div>

    <div class="btn btn-outline-dark" data-bs-toggle="modal" data-bs-target="#deleteReviewModal">@AndHowIsItApp.Resources.Language.DeleteReview</div>
    <div class="modal fade" id="deleteReviewModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="deleteModalLable">@AndHowIsItApp.Resources.Language.DeleteConfirm</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label=@AndHowIsItApp.Resources.Language.Cancel></button>
                </div>
                <div class="modal-body">
                    @AndHowIsItApp.Resources.Language.DeleteReviewConfirmText @Model.Title?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-dark" data-bs-dismiss="modal">@AndHowIsItApp.Resources.Language.Cancel</button>
                    <div>@Html.ActionLink(AndHowIsItApp.Resources.Language.DeleteReview, "DeleteReview", new { userId = Model.AuthorId, reviewId = Model.Id }, new { @class = "btn btn-outline-danger" })</div>
                </div>
            </div>
        </div>
    </div>
}

<div hidden id="subject-id">@Model.Subject.Id</div>
<h2>@AndHowIsItApp.Resources.Language.Category: @Model.Subject.Category</h2>
<h1>@Model.Subject.Name</h1>
<div>@AndHowIsItApp.Resources.Language.PieceOfArtRating</div>
<div id="usersRating">@Model.Subject.Rating</div>

@if (Request.IsAuthenticated)
{
    <div>@AndHowIsItApp.Resources.Language.YourPieceOfArtRating</div>
    <input type="radio" name="subjectRating" id="subjectRating-1" onchange="rateSubject(1)" />
    <input type="radio" name="subjectRating" id="subjectRating-2" onchange="rateSubject(2)" />
    <input type="radio" name="subjectRating" id="subjectRating-3" onchange="rateSubject(3)" />
    <input type="radio" name="subjectRating" id="subjectRating-4" onchange="rateSubject(4)" />
    <input type="radio" name="subjectRating" id="subjectRating-5" onchange="rateSubject(5)" />
}
<br />

<div hidden id="review-id">@Model.Id</div>
<h2>@Model.Title</h2>
<div id="allReviewLikes">@Model.Likes</div>

@if (Request.IsAuthenticated)
{
    <input type="checkbox" name="reviewLike" id="reviewLike" onchange="likeReview()" />
}

<h2>@AndHowIsItApp.Resources.Language.Author @Model.Author.UserName</h2>
<h3>@Model.Author.Likes</h3>

<div>@AndHowIsItApp.Resources.Language.Created @Model.CreateDate</div>


<div>@Model.Text</div>

<h2>@Model.Rating/10</h2>

@using (Html.BeginForm("SearchResults", "Home"))
{
    foreach (var tag in Model.Tags)
    {
        <input type="submit" name="tagName" value="@tag">
    }
}

<div>@AndHowIsItApp.Resources.Language.Changed @Model.LastChangeDate</div>

<div>
    @Html.Action("GetPreviewsBySubject", new { subject = Model.Subject.Id, currentReview = Model.Id })
</div>
@{
    if (Request.IsAuthenticated)
    {
        <h3>@AndHowIsItApp.Resources.Language.AddComment:</h3>
        using (Html.BeginForm("AddComment", "Home", FormMethod.Post))
        {
            <input type="hidden" name="reviewId" value="@Model.Id" />
            <input type="text" name="commentText" />
            <input type="submit" value="@AndHowIsItApp.Resources.Language.Add" />
        }
    }
}
<h3>@AndHowIsItApp.Resources.Language.Comments:</h3>
<div id="allComments">
    @Html.Action("GetComments", new { reviewId = Model.Id })
</div>

@section Scripts {
    @Scripts.Render("~/scripts/ReviewPageScripts.js")
}